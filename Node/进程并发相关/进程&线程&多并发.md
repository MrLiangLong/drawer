## Node子进程与线程

##### 进程
1. 操作系统挂载运行程序的单元   
2. 拥有一些独立的资源，如内存等  

##### 线程
1. 进行运算调度的单元  
2. 进程内的线程共享进程内的资源  

进程类似“公司”，线程类似公司的“职员”，主进程类似“公司老板”

##### Node的事件循环
1. 主线程运行V8与JavaScript  
2. 多个子线程通过事件循环被调度  


### Node多进程实战-Cluster模块
目的：使用子进程或者线程利用更多CPU资源。  

实现：主进程启动多个子进程，由主进程轮流分发请求，子进程代为处理。  

```
//创建子进程
const cluster = require('cluster');

if(cluster.isMaster){  //主进程
    //
    const cpus = require('os').cpus().length/2;
    for(let i=0;i<cpus;i++){
        let worker = cluster.fork(); //创建子进程
    }
}

```

##  HTTP服务器性能指标
1. QPS  

QPS一般指每秒查询率。每秒查询率（QPS，Queries-per-second）是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准，计算公式：
```
QPS = 并发量/平均响应时间
```

2. 吞吐量(承压能力)  

一个系统吞吐量通常由QPS（TPS）、并发数两个因素决定，每套系统这两个值都有一个相对极限值，在应用场景访问压力下，只要某一项达到系统最高值，系统的吞吐量就上不去了，如果压力继续增大，系统的吞吐量反而会下降，原因是系统超负荷工作，上下文切换、内存等等其它消耗导致系统性能下降。

### 压力测试工具ab
测试http服务器的性能，获取QPS。

下载地址：https://www.apachehaus.com/cgi-bin/download.plx   
下载解压后可将${abInstallPath}/bin/ 配置到环境系统，注册为全局指令。   

ab压测指令：  

```
ab -n 1000 -c 20 http://127.0.0.1:8080/
-n: 要发多少个请求数
-c: 每次进行多少请求
```